<!-- saved from url=(0037)https://twgljs.org/examples/tiny.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--
    @license twgl.js Copyright (c) 2015, Gregg Tavares All Rights Reserved.
    Available via the MIT license.
    see: http://github.com/greggman/twgl.js for details
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>twgl.js - tiny</title>
  </head>
  <body>
    <canvas id="c" width="1680" height="855"
      style="position: absolute; top: 33vh; right: 33vw; width: 33vw; height: 33vh"></canvas>
  <script id="vs" type="notjs">
#version 300 es

// attribute vec4 position;
layout(location = 0) in vec4 position;

void main() {
  gl_Position = position;
}
  </script>
  <script id="fs" type="notjs">
#version 300 es
precision mediump float;

uniform vec2 resolution;
uniform float time;
uniform float mx;
uniform float my;
out vec4 fragColor;

// TODO slow
float linmap(float a, float b, float c, float d, float x) {
  return ((x - a) * ((d - c) / (b - a))) + c;
}

vec2 toUV(float x, float y) {
  // Assumes horizontal?
  float m = (resolution.x - resolution.y) / 2.0;
  vec2 uv = vec2(linmap(resolution.x/2.0, resolution.x - m, 0.0, 1.0, x),
                 linmap(resolution.y/2.0, resolution.y    , 0.0, 1.0, y));
  return uv;
}

vec4 foo[] = vec4[](vec4(0, 0, 0, 0));
vec4[] foo2 = vec4[](vec4(0, 0, 0, 0));
vec4 foo1 = (vec4[](vec4(0, 0, 0, 0)))[0];
float a[5] = float[](3.4, 4.2, 5.0, 5.2, 1.1);  // same thing
float[5] a2 = float[](3.4, 4.2, 5.0, 5.2, 1.1);  // same thing

void main() {
  vec2 uv = toUV(gl_FragCoord.x, gl_FragCoord.y);
  vec2 mouse = toUV(mx, my);

  SHAPE_ASDF
  // Works
  // float x = dFdx(topColor.r);
  fragColor = topColor;
}
  </script>
  <script type="module">
    let mx = 0;
    let my = 0;
    let canvas = document.getElementById('c');
    export function myFunction(e) {
      mx = e.offsetX;
      my = e.offsetY;
      // console.log(mx + " " + my);
    }
    canvas.addEventListener("mousemove", myFunction, false);

    import * as twgl from './twgl-full.module.js';
    const gl = document.querySelector("#c").getContext("webgl2");
    const programInfo = twgl.createProgramInfo(gl, ["vs", "fs"]);

    const arrays = {
      position: [-1, -1, 0, 1, -1, 0, -1, 1, 0, -1, 1, 0, 1, -1, 0, 1, 1, 0],
    };
    const bufferInfo = twgl.createBufferInfoFromArrays(gl, arrays);

    function render(time) {
      twgl.resizeCanvasToDisplaySize(gl.canvas);
      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

      const uniforms = {
        time: time * 0.001,
        resolution: [gl.canvas.width, gl.canvas.height],
        mx: mx,
        my: my,
      };

      gl.useProgram(programInfo.program);
      twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);
      twgl.setUniforms(programInfo, uniforms);
      twgl.drawBufferInfo(gl, bufferInfo);

      requestAnimationFrame(render);
    }
    requestAnimationFrame(render);
  </script>



</body></html>
